<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Cupface</title>
  </head>
  <body>
    <style>
      canvas {
        border: 10px solid black;
        margin-top: 100px;
        margin-left: 30px;
      }
      #bullets {
        z-index: -1;
      }
      #ship {
        z-index: 0;
      }
    </style>
    <script type="text/javascript">
      document.addEventListener("DOMContentLoaded", () => {
        const bulletCanvas = document.getElementById('bullets');
        const bulletContext = bulletCanvas.getContext('2d');
        const canvas = document.getElementById('ship');
        const context = canvas.getContext('2d');
        const game = {
          bullets: [],
          startingX: 200,
          startingY: 200,
          shipX: 75,
          shipY: 75,
          context,
          bulletContext,
          start: function(x, y) {
            this.context.clearRect(0, 0, 600, 400)
            this.context.fillRect(this.startingX, this.startingY, x, y)
          },
          sleep: function(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
          },
          move: async function(direction) {
            for (var i = 0; i < 24; i++) {
              await game.sleep(20);
              if (direction === "left") {
                game.startingX -= 3;
              } else if (direction == "right") {
                game.startingX += 3;
              } else if (direction == "up") {
                game.startingY -= 3;
              } else {
                game.startingY += 3;
              }
            }
          },
          bullet: function(x, y, velocity) {

          },
          shoot: function() {
            let newBullet = new bullet();
            newBullet.init();
            game.bullets.push(newBullet);
            // this.context.fillRect(this.startingX + this.shipX + 20, this.startingY + this.shipY, 5, 5)
          },
          shrink: async function() {
            for (var i = 0; i < 8; i++) {
              await game.sleep(40);
              this.shipX -= 3;
              this.shipY -= 3;
            }
          },
          grow: async function() {
            for (var i = 0; i < 8; i++) {
              await game.sleep(40);
              this.shipX += 3;
              this.shipY += 3;
            }
          }
        }
        const step = () => {
          game.start(game.shipX, game.shipY)
          requestAnimationFrame(step)
        }
        document.addEventListener("keydown", async (e) => {
          switch (e.keyCode) {
            case 90:
              console.log("z, parry");

            case 9:
              console.log('tab, bomb');
              break
            case 16:
              game.shrink()
              console.log('shift, shrink');
              break
            case 87 || 38:
              game.move("up");
              break
            case 65 || 37:
              game.move('left')
              break
            case 83 || 40:
              game.move("down")
              break
            case 68 || 39:
              game.move("right")
              break
            case 88:
              console.log('x, shoot');
              game.shoot("simple")
              break
            default:
              console.log("GGXD");
              break
          }
        });
        document.addEventListener("keyup", (e) => {
          switch (e.keyCode) {
            case 16:
              game.grow();
              break;
            default:
              break;
          }
        })
        step()
      });
    </script>
    <canvas id="ship" height='400' width='600'></canvas>
    <canvas id="bullets" width="300" height="300"></canvas>
  </body>
</html>
